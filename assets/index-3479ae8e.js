import{_ as B}from"./index-8195af15.js";import{r as c,G as $,c as x,m as q,w as u,e as l,f as r,i as N,aY as L,M as w,aZ as O,a_ as P,a$ as U,a4 as K,b0 as E,d as S,R as T,h as k,b1 as j,b2 as M,I as V,B as A,W as G}from"./index-7a9d41ff.js";import{f as F,k as D}from"./index-a6ad3bbb.js";import{_ as R,P as W}from"./index-2ed1f046.js";import{D as C}from"./slotCell.vue_vue_type_script_lang-29b687d4.js";import{_ as Y}from"./index-9406b837.js";import{L as Z}from"./index-ef58f53f.js";import"./index-e9609de1.js";const z={__name:"edit",emits:["submit"],setup(I,{expose:f,emit:m}){const e=c(!1),b=m,_=c(null),s=$(()=>`${_.value?"编辑":"添加"}用户`),t=c([]),a=c(null),n=c([{cmp:"input",name:"userName",label:"用户名称",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"input",name:"password",label:"用户密码",rules:$(()=>_.value?[]:[{required:!0,message:"必填",type:"error",trigger:"blur"}]),itemOptions:$(()=>({disabled:!!_.value,placeholder:_.value?"如需修改，请重置密码":"请输入用户密码"}))},{cmp:"input",name:"nickName",label:"用户昵称",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"select",name:"roleIds",label:"角色",itemOptions:{options:$(()=>t.value),keys:{value:"roleId",label:"roleName"},multiple:!0},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"input",name:"phonenumber",label:"手机号"},{cmp:"input",name:"email",label:"邮箱"},{cmp:"radio",name:"status",label:"状态",itemOptions:{options:F(D,!0)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"textarea",name:"remark",label:"备注"}]),o=async()=>{const i=await a.value.getFormData(!0);if(i===!1)return!1;i.userId?(await L({...i}),w.success("用户编辑成功")):(await O({...i}),w.success("用户添加成功")),b("submit"),e.value=!1},y={status:"0",roleSort:"0"};return f({open:(i=null)=>{_.value=i,e.value=!0,P().then(p=>{t.value=p.rows}),i?U({id:i}).then(p=>{const g=(p.data.roles||[]).map(d=>d.roleId);K(()=>{a.value.fillFormData({...y,...p.data,roleIds:g})})}):K(()=>{a.value.fillFormData({...y})})}}),(i,p)=>{const g=R,d=C;return x(),q(d,{visible:r(e),"onUpdate:visible":p[0]||(p[0]=h=>N(e)?e.value=h:null),attach:"body",header:r(s),"destroy-on-close":"",placement:"center",width:"600px","on-confirm":o},{body:u(()=>[l(g,{ref_key:"$form",ref:a,forms:r(n)},null,8,["forms"])]),_:1},8,["visible","header"])}}},H={__name:"reset",emits:["submit"],setup(I,{expose:f,emit:m}){const e=c(!1),b=m,_=$(()=>"重置密码"),s=c(null),t=[{cmp:"input",name:"password",label:"新密码",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]}],a=async()=>{const o=await s.value.getFormData(!0);if(o===!1)return!1;await E({...o}),w.success("用户密码重置成功"),b("submit"),e.value=!1};return f({open:(o=null)=>{e.value=!0,o&&K(()=>{s.value.fillFormData({userId:o})})}}),(o,y)=>{const v=R,i=C;return x(),q(i,{visible:r(e),"onUpdate:visible":y[0]||(y[0]=p=>N(e)?e.value=p:null),attach:"body",header:r(_),"destroy-on-close":"",placement:"center",width:"400px","on-confirm":a},{body:u(()=>[l(v,{ref_key:"$form",ref:s,forms:t},null,512)]),_:1},8,["visible","header"])}}},J={__name:"detail",setup(I,{expose:f}){const m=c(!1),e=c({}),b=[{colKey:"userName",label:"用户名称"},{colKey:"nickName",label:"用户昵称"},{colKey:"roleIds",label:"角色",cell:s=>(s.roles||[]).map(t=>t.roleName).join(", ")},{colKey:"phonenumber",label:"手机号"},{colKey:"email",label:"邮箱"},{colKey:"status",label:"状态",cell:s=>{var t;return(t=D[s.status])==null?void 0:t.label}},{colKey:"remark",label:"备注"}];return f({open:(s=null)=>{m.value=!0,s&&U({id:s}).then(t=>{e.value=t.data})}}),(s,t)=>{const a=Y,n=C;return x(),q(n,{visible:r(m),"onUpdate:visible":t[0]||(t[0]=o=>N(m)?m.value=o:null),attach:"body",header:"用户详情","destroy-on-close":"",placement:"center",width:"400px",footer:!1},{body:u(()=>[l(a,{columns:b,data:r(e)},null,8,["data"])]),_:1},8,["visible"])}}},ne={__name:"index",setup(I){const f=c(null),m=c(null),e=c(null),b=c(null),_=[{cmp:"input",name:"userName",label:"用户名称"},{cmp:"select",name:"status",label:"状态",itemOptions:{options:F(D)}}],s=[{colKey:"serial-number",title:"#",width:60},{colKey:"userId",title:"用户编号",width:100},{colKey:"userName",title:"用户名称"},{colKey:"nickName",title:"用户昵称"},{colKey:"roles",title:"角色",cell:(a,{row:n})=>(n.roles||[]).join(", ")},{colKey:"loginDate",title:"登录时间",width:180},{colKey:"status",title:"状态",cell:(a,{row:n})=>{var o;return(o=D[n.status])==null?void 0:o.label},width:80},{colKey:"operation",title:"操作",width:240}],t=a=>{M({id:a}).then(n=>{w.success("用户删除成功"),b.value.refresh()})};return(a,n)=>{const o=V,y=A,v=Z,i=W,p=G,g=B;return x(),S(T,null,[l(g,{ref_key:"$table",ref:b,searchItems:_,columns:s,api:r(j)},{topBtns:u(()=>[l(y,{onClick:n[0]||(n[0]=d=>r(f).open())},{icon:u(()=>[l(o,{name:"add"})]),default:u(()=>[k(" 添加用户 ")]),_:1})]),operation:u(({row:d})=>[l(p,null,{default:u(()=>[l(v,{theme:"primary",onClick:h=>r(e).open(d.userId)},{default:u(()=>[k("查看")]),_:2},1032,["onClick"]),l(v,{theme:"primary",onClick:h=>r(f).open(d.userId)},{default:u(()=>[k("编辑")]),_:2},1032,["onClick"]),l(i,{content:"确认删除此用户吗？",onConfirm:h=>t(d.userId)},{default:u(()=>[l(v,{theme:"primary"},{default:u(()=>[k("删除")]),_:1})]),_:2},1032,["onConfirm"]),l(v,{theme:"primary",onClick:h=>r(m).open(d.userId)},{default:u(()=>[k("重置密码")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["api"]),l(z,{ref_key:"$DialogEdit",ref:f,onSubmit:n[1]||(n[1]=d=>r(b).refresh())},null,512),l(r(H),{ref_key:"$DialogReset",ref:m},null,512),l(r(J),{ref_key:"$DialogDetail",ref:e},null,512)],64)}}};export{ne as default};

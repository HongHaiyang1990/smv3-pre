import{_ as z}from"./index-8195af15.js";import{r as n,G as B,c as k,d as I,e as t,w as o,g as P,f as s,X as F,m as K,h as _,i as R,R as S,ab as T,I as G,B as O,Z as j,p as Q,j as X,_ as Z,aj as A,M,Q as x,af as H,ak as J,W as Y}from"./index-7a9d41ff.js";import{c as ee}from"./index-a6ad3bbb.js";import{a as te,_ as q}from"./computedMaterial.vue_vue_type_script_setup_true_lang-47daa3ba.js";import{_ as V}from"./index-9406b837.js";import{t as le}from"./vue3-print-nb.es-dcda0647.js";import{_ as W}from"./selectProduct.vue_vue_type_script_setup_true_lang-702ae389.js";import{L as U}from"./index-ef58f53f.js";import{D as E}from"./formula-805a3a3b.js";import{P as ae}from"./index-2ed1f046.js";import"./index-e9609de1.js";import"./slotCell.vue_vue_type_script_lang-29b687d4.js";import"./bom.vue_vue_type_script_setup_true_lang-baac5781.js";const oe=$=>(Q("data-v-38e70d2a"),$=$(),X(),$),ne={id:"print-plan"},se=oe(()=>P("div",{style:{"padding-top":"30px"},class:"print-show"},null,-1)),re={style:{"text-align":"right"},class:"print-hide"},ce={__name:"detail",setup($,{expose:w}){const N=le,m=n({id:"print-plan",popTitle:"生产计划"}),b=n(null),u=n(null),f=n(null),i=n(!1),r=n(null),c=B(()=>`生产计划-${p.value.productorderName}`),p=n({}),D=[{colKey:"projectId",label:"所属项目"},{colKey:"productorderName",label:"生产任务名称"},{colKey:"wishDate",label:"期望完成时间"},{colKey:"applyName",label:"申请人"},{colKey:"remark",label:"备注"},{colKey:"fileName",label:"附件",cell:e=>e.fileUrl?t(U,{theme:"primary",onClick:()=>f.value.open(e.fileUrl,e.fileName)},{default:()=>[e.fileName]}):"-"}];return w({open:async(e=null)=>{r.value=e,i.value=!0,e&&T({id:e}).then(l=>{const{materials:y,panel:v,accessory:h,listItem:a,...d}=l.data;b.value.setProductData(a),u.value.setComputedData({materials:y,panel:v,accessory:h}),p.value=l.data})}}),(e,l)=>{const y=V,v=G,h=O,a=j,d=E,g=q;return k(),I(S,null,[t(d,{visible:s(i),"onUpdate:visible":l[0]||(l[0]=L=>R(i)?i.value=L:null),attach:"body",header:s(c),"destroy-on-close":"",placement:"bottom",size:"100%",footer:!1,closeBtn:!0},{body:o(()=>[P("div",ne,[se,t(y,{columnCount:2,"label-width":"150px",columns:D,data:s(p)},null,8,["data"]),P("p",re,[F((k(),K(h,null,{icon:o(()=>[t(v,{name:"print"})]),default:o(()=>[_("打印")]),_:1})),[[s(N),s(m)]])]),t(a,{class:"divider",align:"left"},{default:o(()=>[_("生产产品")]),_:1}),t(s(W),{ref_key:"$selectProduct",ref:b,isDetail:!0},null,512),t(a,{class:"divider",align:"left"},{default:o(()=>[_("物料用量")]),_:1}),t(s(te),{ref_key:"$computedMaterial",ref:u,isDetail:!0},null,512)])]),_:1},8,["visible","header"]),t(g,{ref_key:"$preview",ref:f,canDown:!0},null,512)],64)}}};const ie=Z(ce,[["__scopeId","data-v-38e70d2a"]]),ue={__name:"update",emits:["submit"],setup($,{expose:w,emit:N}){const m=n(null),b=n(null),u=n(!1),f=N,i=n(null),r=B(()=>`报工-${c.value.productorderName}`),c=n({}),p=[{colKey:"projectId",label:"所属项目"},{colKey:"productorderName",label:"生产任务名称"},{colKey:"wishDate",label:"期望完成时间"},{colKey:"applyName",label:"申请人"},{colKey:"remark",label:"备注"},{colKey:"fileName",label:"附件",cell:e=>e.fileUrl?t(U,{theme:"primary",onClick:()=>b.value.open(e.fileUrl,e.fileName)},{default:()=>[e.fileName]}):"-"},{colKey:"workRate",label:"进度",cell:e=>`${e.workRate||0} %`}],D=async()=>{const e=m.value.getProductData(),l=e.map(a=>({id:a.id,finishNum:(a.finishNum||0)+(a.newNum||0)})),y=l.reduce((a,d)=>a+(d.finishNum||0),0),v=e.reduce((a,d)=>a+(d.expectNum||0),0),h=Math.floor(y/v*100);await A({id:i.value,workRate:h,listItem:l}),M.success("报工成功"),f("submit"),u.value=!1};return w({open:async(e=null)=>{i.value=e,u.value=!0,e&&T({id:e}).then(l=>{const{materials:y,panel:v,accessory:h,listItem:a,...d}=l.data;a.map(g=>{g.newNum=g.finishNum||0}),m.value.setProductData(a),c.value=l.data})}}),(e,l)=>{const y=V,v=j,h=E,a=q;return k(),I(S,null,[t(h,{visible:s(u),"onUpdate:visible":l[0]||(l[0]=d=>R(u)?u.value=d:null),attach:"body",header:s(r),"destroy-on-close":"",placement:"bottom",size:"100%","on-confirm":D},{body:o(()=>[t(y,{columnCount:2,"label-width":"150px",columns:p,data:s(c)},null,8,["data"]),t(v,{class:"divider",align:"left"},{default:o(()=>[_("生产产品")]),_:1}),t(s(W),{ref_key:"$selectProduct",ref:m,isUpdate:!0},null,512)]),_:1},8,["visible","header"]),t(a,{ref_key:"$preview",ref:b,canDown:!0},null,512)],64)}}},De={__name:"index",setup($){const w=n(null),N=n(null),m=n(null),b=[{cmp:"input",name:"productorderName",label:"生产任务名称"}],u=[{colKey:"serial-number",title:"#",width:60},{colKey:"id",title:"生产计划"},{colKey:"productorderName",title:"生产任务名称"},{colKey:"createTime",title:"申请时间"},{colKey:"designer",title:"设计师"},{colKey:"wishDate",title:"审核人"},{colKey:"wishDate",title:"期望完成时间"},{colKey:"workStatus",title:"状态",cell:(i,{row:r})=>{var c;return(c=ee[r.workStatus])==null?void 0:c.label}},{colKey:"workRate",title:"进度",cell:(i,{row:r})=>`${r.workRate||0} %`},{colKey:"remark",title:"备注"},{colKey:"operation",title:"操作",width:160}],f=(i,r=0)=>{J({id:i,workStatus:r}).then(()=>{M.success(`生产计划已${r==1?"暂停":r==9?"停止":"恢复"}`),m.value.refresh()})};return(i,r)=>{const c=U,p=ae,D=Y,C=z;return k(),I(S,null,[t(C,{ref_key:"$table",ref:m,searchItems:b,columns:u,api:s(H),searchExtras:{status:5}},{operation:o(({row:e})=>[t(D,null,{default:o(()=>[e.workStatus==1?(k(),K(p,{key:0,content:"恢复后可以继续报工，确认恢复此生产计划吗？",onConfirm:l=>f(e.id,0)},{default:o(()=>[t(c,{theme:"primary"},{default:o(()=>[_(" 恢复 ")]),_:1})]),_:2},1032,["onConfirm"])):x("",!0),e.workStatus==0?(k(),K(p,{key:1,content:"暂停后将禁止报工，确认暂停此生产计划吗？",onConfirm:l=>f(e.id,1)},{default:o(()=>[t(c,{theme:"primary"},{default:o(()=>[_(" 暂停 ")]),_:1})]),_:2},1032,["onConfirm"])):x("",!0),e.workStatus==1?(k(),K(p,{key:2,content:"停止后将终止生产计划，无法再次恢复，确认停止此生产计划吗？",onConfirm:l=>f(e.id,9)},{default:o(()=>[t(c,{theme:"primary"},{default:o(()=>[_(" 停止 ")]),_:1})]),_:2},1032,["onConfirm"])):x("",!0),t(c,{theme:"primary",onClick:l=>s(w).open(e.id)},{default:o(()=>[_(" 查看 ")]),_:2},1032,["onClick"]),e.workStatus==0?(k(),K(c,{key:3,theme:"primary",onClick:l=>s(N).open(e.id)},{default:o(()=>[_(" 报工 ")]),_:2},1032,["onClick"])):x("",!0)]),_:2},1024)]),_:1},8,["api"]),t(ie,{ref_key:"$DialogDetail",ref:w},null,512),t(ue,{ref_key:"$DialogUpdate",ref:N,onSubmit:r[0]||(r[0]=e=>s(m).refresh())},null,512)],64)}}};export{De as default};

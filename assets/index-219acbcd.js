import{r as p,G as w,c as $,m as E,w as n,e as a,aQ as q,f as c,h as _,t as S,i as K,aR as N,M as I,aS as B,aT as C,a4 as k,o as L,d as O,g as P,R,aU as V,W as A,aV as Y,I as U,B as G}from"./index-7a9d41ff.js";import{f as D,d as F,h as M}from"./index-a6ad3bbb.js";import{_ as Q,P as W}from"./index-2ed1f046.js";import{F as j}from"./index-e9609de1.js";import{D as z}from"./slotCell.vue_vue_type_script_lang-29b687d4.js";import{E as H,L as J}from"./index-ef58f53f.js";const X={__name:"edit",emits:["submit"],setup(x,{expose:g,emit:d}){const u=p(!1),h=d,b=p(null),f=w(()=>`${b.value?"编辑":"添加"}物料分类`),s=p({}),r=p(null),t=p([{cmp:"slot",slotName:"parent"},{cmp:"input",name:"itemTypeName",label:"名称",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"select",name:"itemCategory",label:"类型",itemOptions:{options:D(F)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"radio",name:"enableFlag",label:"状态",itemOptions:{options:D(M)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"textarea",name:"remark",label:"备注"}]),o=async()=>{const e=await r.value.getFormData(!0);if(e===!1)return!1;e.itemTypeId?(await N(e),I.success("物料分类编辑成功")):(await B({...e,itemOrProduct:"ITEM"}),I.success("物料分类添加成功")),h("submit"),u.value=!1};return g({open:(e=null,l=null)=>{b.value=l,l?(C({id:l}).then(i=>{r.value.fillFormData(i.data)}),e?C({id:e}).then(i=>{s.value=i.data}):s.value={}):e?C({id:e}).then(i=>{s.value=i.data,k(()=>{r.value.fillFormData({parentTypeId:e||0,itemCategory:s.value.itemCategory,enableFlag:"Y"})})}):(s.value={},k(()=>{r.value.fillFormData({parentTypeId:e||0,enableFlag:"Y"})})),u.value=!0}}),(e,l)=>{const i=j,T=Q,m=z;return $(),E(m,{visible:c(u),"onUpdate:visible":l[0]||(l[0]=v=>K(u)?u.value=v:null),attach:"body",header:c(f),"destroy-on-close":"",placement:"center",width:"600px","on-confirm":o},{body:n(()=>[a(T,{ref_key:"$form",ref:r,forms:c(t),initData:{enableFlag:"Y"}},q({_:2},[c(s).itemTypeId?{name:"parent",fn:n(()=>[a(i,{label:"上级分类"},{default:n(()=>[_(S(c(s).itemTypeName),1)]),_:1})]),key:"0"}:void 0]),1032,["forms"])]),_:1},8,["visible","header"])}}},Z={class:"search-container"},re={__name:"index",setup(x){const g=p(null),d=p(null),u=[{colKey:"itemTypeName",title:"分类名称"},{colKey:"itemCategory",title:"类型",cell:(r,{row:t})=>{var o;return(o=F[t.itemCategory])==null?void 0:o.label},width:120},{colKey:"enableFlag",title:"状态",cell:(r,{row:t})=>{var o;return(o=M[t.enableFlag])==null?void 0:o.label},width:80},{colKey:"createTime",title:"创建时间",width:190},{colKey:"operation",title:"操作",width:190}],h=p([]),b={childrenKey:"children",defaultExpandAll:!0},f=async()=>{const t=(await V()).data.map(e=>({...e,children:[]})),o=new Map;t.forEach(e=>{o.set(e.itemTypeId,e)}),t.forEach(e=>{if(e.parentTypeId){const l=o.get(e.parentTypeId);l&&l.children.push(e)}});const y=t.filter(e=>!e.parentTypeId);h.value=y,k(()=>{g.value.expandAll()})};L(()=>{f()});const s=r=>{Y({id:r}).then(t=>{I.success("分类删除成功"),f()})};return(r,t)=>{const o=U,y=G,e=A,l=J,i=W,T=H;return $(),O(R,null,[P("div",Z,[a(e,null,{default:n(()=>[a(y,{variant:"outline",theme:"primary",onClick:t[0]||(t[0]=m=>f())},{icon:n(()=>[a(o,{name:"refresh"})]),default:n(()=>[_(" 刷新 ")]),_:1})]),_:1}),a(e,null,{default:n(()=>[a(y,{theme:"primary",onClick:t[1]||(t[1]=m=>c(d).open())},{icon:n(()=>[a(o,{name:"plus"})]),default:n(()=>[_(" 添加一级分类 ")]),_:1})]),_:1})]),a(T,{ref_key:"$table",ref:g,columns:u,data:c(h),tree:b,rowKey:"itemTypeId"},{operation:n(({row:m})=>[a(e,null,{default:n(()=>[a(l,{theme:"primary",onClick:v=>c(d).open(m.parentTypeId,m.itemTypeId)},{default:n(()=>[_(" 修改 ")]),_:2},1032,["onClick"]),a(l,{theme:"primary",onClick:v=>c(d).open(m.itemTypeId)},{default:n(()=>[_(" 添加下级 ")]),_:2},1032,["onClick"]),a(i,{content:"确认删除吗？",onConfirm:v=>s(m.itemTypeId)},{default:n(()=>[a(l,{theme:"primary"},{default:n(()=>[_("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["data"]),a(X,{ref_key:"$DialogEdit",ref:d,onSubmit:t[2]||(t[2]=m=>f())},null,512)],64)}}};export{re as default};

import{_ as C}from"./index-2b893b53.js";import{r,G as F,c as I,m as B,w as a,e as s,f as l,i as w,b5 as V,M as g,b6 as E,b7 as P,b8 as S,b9 as L,ae as O,d as M,R as U,h,a_ as A,ba as G,I as W,B as j,W as z}from"./index-eb14e6bd.js";import{f as K,l as k}from"./index-a6ad3bbb.js";import{T as H,_ as J,P as Q}from"./index-f25cfa19.js";import{F as X}from"./index-e40dd58c.js";import{D as Y}from"./slotCell.vue_vue_type_script_lang-12effd0a.js";import{L as Z}from"./index-158b6f05.js";const ee={__name:"edit",emits:["submit"],setup(q,{expose:u,emit:c}){const m=r(!1),b=c,_=r(null),p=F(()=>`${_.value?"编辑":"添加"}角色`),o=r(null),i=r([{cmp:"input",name:"roleName",label:"角色名称",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"input",name:"roleKey",label:"权限字符",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"slot",slotName:"nodes"},{cmp:"radio",name:"status",label:"状态",itemOptions:{options:K(k,!0)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"textarea",name:"remark",label:"备注"}]),d=r([]),n=r([]),v=async()=>{const e=await o.value.getFormData(!0);if(e===!1)return!1;e.roleId?(await V({...e,menuIds:n.value}),g.success("角色编辑成功")):(await E({...e,menuIds:n.value}),g.success("角色添加成功")),b("submit"),m.value=!1},f={status:"0",roleSort:"0"};return u({open:(e=null)=>{_.value=e,m.value=!0,e?(P({id:e}).then(t=>{d.value=t.menus,n.value=t.checkedKeys}),S({id:e}).then(t=>{o.value.fillFormData({...f,...t.data})})):L().then(t=>{d.value=t.data,n.value=[],o.value.fillFormData({...f})})}}),(e,t)=>{const x=H,D=O,R=X,T=J,N=Y;return I(),B(N,{visible:l(m),"onUpdate:visible":t[1]||(t[1]=y=>w(m)?m.value=y:null),attach:"body",header:l(p),"destroy-on-close":"",placement:"center",width:"600px","on-confirm":v},{body:a(()=>[s(T,{ref_key:"$form",ref:o,forms:l(i)},{nodes:a(()=>[s(R,{label:"权限"},{default:a(()=>[s(D,null,{default:a(()=>[s(x,{ref:"$tree",modelValue:l(n),"onUpdate:modelValue":t[0]||(t[0]=y=>w(n)?n.value=y:null),data:l(d),keys:{value:"id"},checkable:"",hover:""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1},8,["forms"])]),_:1},8,["visible","header"])}}},me={__name:"index",setup(q){const u=r(null),c=r(null),m=[{cmp:"input",name:"roleName",label:"角色名称"},{cmp:"select",name:"status",label:"状态",itemOptions:{options:K(k)}}],b=[{colKey:"serial-number",title:"#",width:60},{colKey:"roleId",title:"角色编号",width:100},{colKey:"roleName",title:"角色名称"},{colKey:"roleKey",title:"权限字符"},{colKey:"createTime",title:"创建时间",width:180},{colKey:"status",title:"状态",cell:(p,{row:o})=>{var i;return(i=k[o.status])==null?void 0:i.label},width:80},{colKey:"operation",title:"操作",width:160}],_=p=>{G({id:p}).then(o=>{g.success("角色删除成功"),u.value.refresh()})};return(p,o)=>{const i=W,d=j,n=Z,v=Q,f=z,$=C;return I(),M(U,null,[s($,{ref_key:"$table",ref:u,searchItems:m,columns:b,api:l(A)},{topBtns:a(()=>[s(d,{onClick:o[0]||(o[0]=e=>l(c).open())},{icon:a(()=>[s(i,{name:"add"})]),default:a(()=>[h(" 添加角色 ")]),_:1})]),operation:a(({row:e})=>[s(f,null,{default:a(()=>[s(n,{theme:"primary",onClick:t=>l(c).open(e.roleId)},{default:a(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),s(v,{content:"确认删除此角色吗？",onConfirm:t=>_(e.roleId)},{default:a(()=>[s(n,{theme:"primary"},{default:a(()=>[h("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["api"]),s(ee,{ref_key:"$DialogEdit",ref:c,onSubmit:o[1]||(o[1]=e=>l(u).refresh())},null,512)],64)}}};export{me as default};

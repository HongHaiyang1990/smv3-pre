import{r as d,G as E,c as x,m as F,w as a,e as n,aQ as K,f as m,h as _,t as B,i as M,bd as L,M as k,be as S,bf as I,a4 as D,o as O,d as P,g as R,R as V,bg as A,W as G,bh as Q,I as U,B as W}from"./index-eb14e6bd.js";import{f as C,m as w,n as T}from"./index-a6ad3bbb.js";import{_ as j,P as z}from"./index-f25cfa19.js";import{F as H}from"./index-e40dd58c.js";import{D as J}from"./slotCell.vue_vue_type_script_lang-12effd0a.js";import{E as X,L as Y}from"./index-158b6f05.js";const Z={__name:"edit",emits:["submit"],setup(q,{expose:b,emit:p}){const l=d(!1),v=p,y=d(null),f=E(()=>`${y.value?"编辑":"添加"}权限`),c=d({}),o=d(null),t=d([{cmp:"slot",slotName:"parent"},{cmp:"input",name:"menuName",label:"权限名称",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"select",name:"menuType",label:"类型",itemOptions:{options:C(w)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]},{cmp:"input",name:"perms",label:"标识",rules:[{required:!0,message:"必填",type:"error",trigger:"blur"}]},{cmp:"radio",name:"status",label:"状态",itemOptions:{options:C(T,!0)},rules:[{required:!0,message:"必选",type:"error",trigger:"change"}]}]),s=async()=>{const e=await o.value.getFormData(!0);if(e===!1)return!1;e.menuId?(await L(e),k.success("权限编辑成功")):(await S({...e}),k.success("权限添加成功")),v("submit"),l.value=!1};return b({open:(e=null,r=null)=>{y.value=r,r?(I({id:r}).then(i=>{o.value.fillFormData(i.data)}),e?I({id:e}).then(i=>{c.value=i.data}):c.value={}):e?I({id:e}).then(i=>{c.value=i.data,D(()=>{o.value.fillFormData({parentId:e||0,menuType:"C",status:"0",visible:"0",orderNum:0})})}):(c.value={},D(()=>{o.value.fillFormData({parentId:e||0,menuType:"C",status:"0",visible:"0",orderNum:0})})),l.value=!0}}),(e,r)=>{const i=H,g=j,u=J;return x(),F(u,{visible:m(l),"onUpdate:visible":r[0]||(r[0]=N=>M(l)?l.value=N:null),attach:"body",header:m(f),"destroy-on-close":"",placement:"center",width:"600px","on-confirm":s},{body:a(()=>[n(g,{ref_key:"$form",ref:o,forms:m(t)},K({_:2},[m(c).menuId?{name:"parent",fn:a(()=>[n(i,{label:"上级权限"},{default:a(()=>[_(B(m(c).menuName),1)]),_:1})]),key:"0"}:void 0]),1032,["forms"])]),_:1},8,["visible","header"])}}},ee={class:"search-container"},le={__name:"index",setup(q){const b=d(null),p=d(null),l=d([]),v=[{colKey:"menuName",title:"权限名称"},{colKey:"menuType",title:"类型",width:100,cell:(o,{row:t})=>{var s;return(s=w[t.menuType])==null?void 0:s.label}},{colKey:"perms",title:"标识"},{colKey:"status",title:"状态",width:100,cell:(o,{row:t})=>{var s;return(s=T[t.status])==null?void 0:s.label}},{colKey:"operation",title:"操作",width:180}],y={childrenKey:"children",defaultExpandAll:!0},f=()=>{A().then(o=>{l.value=o.data;const t=o.data.map(e=>({...e,children:[]})),s=new Map;t.forEach(e=>{s.set(e.menuId,e)}),t.forEach(e=>{if(e.parentId){const r=s.get(e.parentId);r&&r.children.push(e)}});const h=t.filter(e=>!e.parentId);l.value=h})},c=o=>{Q({id:o}).then(t=>{k.success("分类删除成功"),f()})};return O(()=>{f()}),(o,t)=>{const s=U,h=W,e=G,r=Y,i=z,g=X;return x(),P(V,null,[R("div",ee,[n(e,null,{default:a(()=>[n(h,{variant:"outline",theme:"primary",onClick:t[0]||(t[0]=u=>f())},{icon:a(()=>[n(s,{name:"refresh"})]),default:a(()=>[_(" 刷新 ")]),_:1})]),_:1}),n(e,null,{default:a(()=>[n(h,{theme:"primary",onClick:t[1]||(t[1]=u=>m(p).open())},{icon:a(()=>[n(s,{name:"plus"})]),default:a(()=>[_(" 添加一级权限 ")]),_:1})]),_:1})]),n(g,{ref_key:"$table",ref:b,columns:v,data:m(l),tree:y,rowKey:"menuId"},{operation:a(({row:u,rowIndex:N})=>[n(e,null,{default:a(()=>[n(r,{theme:"primary",onClick:$=>m(p).open(u.parentId,u.menuId)},{default:a(()=>[_("修改")]),_:2},1032,["onClick"]),n(r,{theme:"primary",onClick:$=>m(p).open(u.menuId)},{default:a(()=>[_("添加下级")]),_:2},1032,["onClick"]),n(i,{content:"删除后，下级也将被删除，确认删除吗？",onConfirm:$=>c(u.menuId)},{default:a(()=>[n(r,{theme:"primary"},{default:a(()=>[_("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:1},8,["data"]),n(Z,{ref_key:"$DialogEdit",ref:p,onSubmit:t[2]||(t[2]=u=>f())},null,512)],64)}}};export{le as default};
